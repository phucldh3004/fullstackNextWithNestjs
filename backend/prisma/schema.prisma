// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  password    String
  phone       String?
  address     String?
  image       String?
  account_type String  @default("local")
  role        String  @default("user")
  is_active   Boolean @default(true)
  code_id     String?
  code_expired DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

  // Relations
  createdLeads    Lead[]     @relation("CreatedBy")
  assignedLeads   Lead[]     @relation("AssignedTo")
  createdCampaigns Campaign[] @relation("CreatedBy")
  assignedCustomers Customer[] @relation("AssignedTo")
  createdOrders   Order[]    @relation("OrderCreatedBy")
  createdPayments Payment[]  @relation("PaymentCreatedBy")
  assignedTickets Ticket[]   @relation("TicketAssignedTo")
  createdTickets  Ticket[]   @relation("TicketCreatedBy")
  ticketComments  TicketComment[]

  @@map("users")
}

model Customer {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  phone       String?
  address     String?
  customerType String  @default("INDIVIDUAL")
  status      String   @default("ACTIVE")
  assignedTo  String?
  assignedToUser User?     @relation("AssignedTo", fields: [assignedTo], references: [id])
  company     String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

  // Relations
  convertedFromLead Lead? @relation("ConvertedToCustomer")
  orders          Order[]
  payments        Payment[]
  tickets         Ticket[]

  @@map("customers")
}

model Lead {
  id          String   @id @default(cuid())
  name        String
  email       String
  phone       String?
  company     String?
  source      String?
  status      String   @default("NEW")
  assignedTo  String?
  assignedToUser User?     @relation("AssignedTo", fields: [assignedTo], references: [id])
  createdBy   String
  createdByUser User      @relation("CreatedBy", fields: [createdBy], references: [id])
  notes       String?
  budget      Float?
  timeline    String?
  lastContact DateTime?
  convertedToCustomer String? @unique
  convertedToCustomerRelation Customer? @relation("ConvertedToCustomer", fields: [convertedToCustomer], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

  @@map("leads")
}

model Campaign {
  id          String   @id @default(cuid())
  name        String
  description String?
  type        String
  status      String   @default("DRAFT")
  createdBy   String
  createdByUser User     @relation("CreatedBy", fields: [createdBy], references: [id])
  startDate   DateTime?
  endDate     DateTime?
  targetAudience String?
  content     String?
  subject     String?
  budget      Float?
  leadCount   Int?
  conversionRate Float?
  cost        Float?
  revenue     Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())

  @@map("campaigns")
}

model Order {
  id          String   @id @default(cuid())
  orderNumber String   @unique
  customerId  String
  customer    Customer @relation(fields: [customerId], references: [id])
  status      String   @default("NEW")
  totalAmount Float
  items       Json?
  notes       String?
  createdBy   String
  createdByUser User   @relation("OrderCreatedBy", fields: [createdBy], references: [id])
  payments    Payment[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("orders")
}

model Payment {
  id            String   @id @default(cuid())
  receiptNumber String   @unique
  amount        Float
  paymentMethod String   @default("CASH") // CASH, BANK_TRANSFER, ONLINE_PAYMENT
  status        String   @default("COMPLETED") // PENDING, COMPLETED, FAILED
  notes         String?
  
  orderId       String?
  order         Order?   @relation(fields: [orderId], references: [id])
  
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  
  createdBy     String
  createdByUser User     @relation("PaymentCreatedBy", fields: [createdBy], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())

  @@map("payments")
}

model Ticket {
  id            String   @id @default(cuid())
  ticketNumber  String   @unique
  title         String
  description   String
  priority      String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  status        String   @default("NEW") // NEW, IN_PROGRESS, WAITING_RESPONSE, RESOLVED, CLOSED
  
  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id])
  
  assignedTo    String?
  assignedToUser User?    @relation("TicketAssignedTo", fields: [assignedTo], references: [id])
  
  createdBy     String
  createdByUser User     @relation("TicketCreatedBy", fields: [createdBy], references: [id])
  
  comments      TicketComment[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())

  @@map("tickets")
}

model TicketComment {
  id        String   @id @default(cuid())
  content   String
  ticketId  String
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@map("ticket_comments")
}